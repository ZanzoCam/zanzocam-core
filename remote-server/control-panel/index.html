<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta content="text/html">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Pannello di controllo ZANZOCAM">
  
  <title>ZANZOCAM - Impostazioni</title>
    
  <link href="milligram.css" rel="stylesheet">
  <link rel="shortcut icon" type="image/png" href="logos/favicon.png"/>

  
  <script>  
    /*
     * Get JSON data from the server.
     * Useful if the page is hosted with the JSON on the remote server
     */
    function loadDataFromServer(url){
        fetch(url, { method:'GET'})
        .then(response => response.json())
        .then(json => {
            last_loaded_data = json.configuration;
            fillForm(last_loaded_data, "");
        });
    }
    
    /*
     * Get JSON data from a local file.
     * Useful if this page is running from a local HTML file on an offline machine.
     * No images will be available.
     */
    function loadDataFromFile(form){
        if (form.files.length === 0) {
            alert('Seleziona il file di configurazione da modificare.');
            return;
        }        
        var filename = form.files[0].name;
        var extension = filename.substring(filename.lastIndexOf(".")+1, filename.length);
        if (extension==="json"){
            
            const reader = new FileReader();
            reader.onload = function fileReadCompleted() {
                data = JSON.parse(reader.result);
                last_loaded_data = data;
                fillForm(last_loaded_data, "");
            };
            reader.readAsText(form.files[0]);

        } else {
            alert("ATTENZIONE! Il file che hai selezionato non Ã¨ un file di configurazione. Il nome del file deve finire con .json.");
        }
    }
    
    /*
     * Load local images to render them in the configuration file.
     * Used to preview a new image that has been selected but is neither online
     * not in the zip yet.
     */
    function loadLocalImage(filePicker) {
        const reader = new FileReader();
        reader.onload = function fileReadCompleted() {
            document.getElementById(filePicker.id+"__preview").src = reader.result;
            document.getElementById(filePicker.id+"__path").innerHTML = reader.result;
            document.getElementById(filePicker.id+"__path_current").innerHTML = filePicker.files[0].name;
        };
        reader.readAsDataURL(filePicker.files[0]);
    }

    /*
     * Loads the JSON data into the form.
     */
    function fillForm(data, prefix){
        // Hide the loading box and display the main form
	    document.getElementById("loading").style.display="none";  
	    document.getElementById("main-form").style.display="block"; 

	    // Get all the form input elements
	    const { elements } = document.querySelector('form');
        
        for (const [ key, value ] of Object.entries(data) ) {
            // Nested objects should be processed recursively
	        if (typeof value === 'object' & value !== null){
                fillForm(value, prefix+key+"__");
	        }
            // Check if there is an input field matching the name of the data field	        
            const field = elements.namedItem(prefix+key)
            if (field){
                // If the value is a Boolean, the field should be a checkbox: check it                     
	            if (field.type === 'checkbox'){
		            field.checked = value ? true : false; 
	            
                // Handle radioboxes and multiple checkboxes with the same name.                   
	            }if (!field.type && field[0].type==="checkbox"){
	                field.forEach((f) => {
    		            f.checked = value ? true : false; 
	                });
	            
                // If it's the image path, render the image in the nearby box
                } else if(key === "path"){
                    document.getElementById(prefix+key+"_current").innerHTML = "<b>"+value+"</b>";
                    document.getElementById(prefix+key).value = value;
                    if (localMode){
                        server_url = document.getElementById("server-url").value;
                        document.getElementById(prefix+"preview").alt = "Preview non disponibile in modalita' offline";
                        document.getElementById(prefix+"preview").src = server_url + "configuration/overlays/" + value;
                    } else {
                        document.getElementById(prefix+"preview").src = url + "configuration/overlays/" + value;
                    }
                // If it's a filepicker, ignore
                } else if(field.type === "file"){
                    
                // If it's not an object, you can safely fill the value in
                } else {
                    field.value = value
                }
            }
            // Special processing is needed for the server protocol radio switch
	        if (prefix === "server__" &&  key === "protocol"){
	            toggle_server_protocol(value);
	        }
            // Special processing is needed for the max images switch
	        if (prefix === "server__" &&  key === "max_photos"){
                if (value != 0 && value != 1){
                    // Toggle to the correct button
                    document.getElementById("max_photos_value").checked = true;
                    // Set the value of the toggle button
                    document.getElementById("max_photos_value").value = value;
                    // Display the input to change the value
                    document.getElementById("max_photos_block").style.display = "block";
                    // Set the initial value to the config file value
                    document.getElementById("max_photos_input").value = value;
                }
	        }
	        // Special processing is needed for the resolution selector (height is the discriminant)
	        if (prefix === "image__" &&  key === "height"){
	            document.getElementById("resolution_selector").value = value; 
	        }
	        // Special processing is needed for the overlay type radio switch
	        prefixes = prefix.split("__");
	        if (prefixes[0] === "overlays" &&  key === "type"){
	            toggle_type_of_overlay(prefixes[1], value);
	        }
            // Special processing is needed for color fields
            if (key === "font_color" || key === "background_color"){
                dropdown = document.getElementById(prefix+key);
	            setColorField(dropdown.nextElementSibling, value, prefix+key);
            }
        }
    }


    /*
     * Sets a value in a deep object given a flat key. Separator: "__"
     */
	function deepSet(key, value, obj){
        var i;
	    key = key.split('__');
	    for (i = 0; i < key.length - 1; i++){
		    if (typeof obj[key[i]] === "undefined"){
		        obj[key[i]] = {};
            }
            obj = obj[key[i]];
	    }
	    obj[key[i]] = value;
	}
	
    /*
     * Gets a value from a deep object given a flat key. Separator: "__"
     */
	function deepGet(key, obj){
        var i;
	    key = key.split('__');
	    for (i = 0; i < key.length - 1; i++){
		    if (typeof obj[key[i]] === "undefined"){
                obj[key[i]] = {};
		    }
            obj = obj[key[i]];        
        }
	    return obj[key[i]];
	}

    /*
     * Converts the form data into a nested JSON object 
     * ready to be sent to the server or returned to the user.
     */
    function formdataToJson(formData){
        var object = {};
        const form = document.getElementById('config');
        Array.from(form.elements).forEach((field) => {
            key = field.name;
            value = formData.get(key);
            
            // Fields that are hidden should not be processed
            // but radios might be hidden by CSS to make the button style
            if (!field.offsetParent && 
                field.type !== "radio" && 
                field.name !== "image__width" && 
                field.name !== "image__height") { 
                    return; 
            }
            // Empty strings are null
            if (value===""){ value = null; }
            
            // Checkboxes are boolean and have their value in the checked attribute
            if (field.type === "checkbox"){
                value = field.checked ? true: false; 
            }
            // Ignore filepickers
            if (field.type === "file"){
                value = null; 
            }
            // Actually set the value
            if (value !== null && value !== "" && typeof value !== 'undefined'){ 
                deepSet(key, value, object);
	        }
        });
        filtered_object = object
        return filtered_object;
    }


    /*
     * Saves the configuration either by sending it to the remote server 
     * (if hosted on the remote server) or by letting the user download it 
     * (if running offline).
     */
    function saveConfiguration(url){
        const form = document.getElementById('config');
        const save = document.getElementById('save');
        save.disabled = true;        
        
        // Serialize the content of the form in a JSON file
        const data = new FormData(form);
        const object = formdataToJson(data);
        serialized = JSON.stringify(object, null, "  ");
        
        // Create a new form with the JSON of the config and all the images
        var formdata = new FormData();
        var images = []
        formdata.append("config", serialized);
        // Get all the images specified in the form
        for(ver of ['top', 'bottom']) {
            for(hor of ['right', 'center', 'left']){
                var field = "overlays__"+ver+"_"+hor+"__file";
                if (data.has(field)){
                    var imageElement = document.getElementById("overlays__"+ver+"_"+hor);
                    formdata.append(field, data.get(field));
                    images.push(imageElement.src);
                }
            }
        }
	    // Send the JSON to the server or ask the user to save it locally
        if (localMode){
            saveConfigurationToJson(formdata);
        } else {
	        saveConfigurationToServer(formdata);
        }
    };
    
    /*
     * Send the updated JSON with the pictures on the server.
     */
    function saveConfigurationToServer(formdata){
        fetch(url, {
            method:'POST',
            body: formdata,
        })
        .then(response => response.json())
        .then(reply => {
            location.reload();
        });
    }
    
    /*
     * Let the user download the JSON file, without the images.
     */
    function saveConfigurationToJson(formdata) {
        var dataString = "data:text/json;charset=utf-8," + encodeURIComponent(serialized);                
        var download = document.createElement('a');
        download.setAttribute("href", dataString);
        download.setAttribute("download", "configuration.json");
        document.body.appendChild(download); // required for firefox
        download.click();
        download.remove();
        alert("ATTENZIONE! Assicurati che sul server siano presenti "+
              "tutte le immagini specificate nel file di configurazione!")
    }
        
    
    // Toggle http or ftp in the server section
    function toggle_server_protocol(value) {
        var http_block = document.getElementById("server_protocol_HTTP-vars");
        var ftp_block = document.getElementById("server_protocol_FTP-vars");
        http_block.style.display = value==="HTTP" ? "flex" : "none";
        ftp_block.style.display = value==="FTP" ? "flex" : "none";
    }
    
    // Toggle text or image config in the overlays section
    function toggle_type_of_overlay(position, value) {
        var text_block = document.getElementById(position+"_text-vars");
        var image_block = document.getElementById(position+"_image-vars");
        text_block.style.display = value==="text" ? "block" : "none";
        image_block.style.display = value==="image" ? "block" : "none";
    }

    // Toggle passwords visibility
    function toggle_password(button) {
        if( button.innerHTML == 'Mostra' ) {
            button.innerHTML = 'Nascondi'
            button.previousElementSibling.type="text";
        } else {
            button.innerHTML = 'Mostra'
            button.previousElementSibling.type="password";
        }
    }

    // Populates the lists of logos already uploaded
    function populateLogosLists(){
        fetch(url, { method:'GET'})
        .then(response => response.json())
        .then(json => {
            var overlays = json.overlays_list;
            var boxes = document.getElementsByClassName("logos-list");
            Array.from(boxes).forEach((box) => {
                var imagesList = "";
                Array.from(overlays).forEach((overlay) => {
                    imagesList += '<img src="../'+overlay+'" style="max-height:80px; max-width:80px; margin:10px;" onclick="javascript:populateLogoField(this);"></img>\n';
                });
                box.innerHTML = imagesList;
            });
        });
    }
    function populateLogoField(logo){
        var position = logo.parentNode.dataset.position;
        var source = logo.src;
        var name = source.split("/").pop();
        document.getElementById("overlays__"+position+"__path").value = name;
        document.getElementById("overlays__"+position+"__path_current").innerHTML = name;
        document.getElementById("overlays__"+position+"__preview").src = source; 
    }

    // Sets a background and a text color to a color input field
    function setColorField(fieldToColor, color, dropdownToReset){
        if (dropdownToReset){
            document.getElementById(dropdownToReset).selectedIndex = 0; 
        }
        textcolor = computeContrastyTextColor(color);
        if (textcolor == null){
            // The color input is not complete yet: go back to white-black
            fieldToColor.style.color = 'black'
            fieldToColor.style.backgroundColor = 'white';
            return;
        }
        fieldToColor.value = color;
        fieldToColor.style.color = textcolor;
        fieldToColor.style.backgroundColor = color;
    }

    // Computes a visible color for the text in a color field (returns either black or white)
    function computeContrastyTextColor(backgroundColor){
        black = [0, 0, 0];
        white = [255, 255, 255];
        if (backgroundColor.length == 9){
            bg = mergeAlphaToWhite(hex2rgba(backgroundColor));
        } else if(backgroundColor.length == 7){
            bg = hex2rgb(backgroundColor);
        } else {
            return null;
        }
        blackContrast = contrast(black, bg);
        whiteContrast = contrast(white, bg);
        if (whiteContrast > blackContrast){
            return "white";
        }
        return "black";
    }

    // Compute the rgb representation of an rgba value on white background
    function mergeAlphaToWhite(rgba){
        r = rgba[0]/255;
        g = rgba[1]/255;
        b = rgba[2]/255;
        a = rgba[3]/255;
        return [
            // Formula: Target.R = ((1 - Source.A) * BGColor.R) + (Source.A * Source.R)    (replace R with G, B to get the other two channels)
            // BGColor is white, so [1, 1, 1]
            (((1 - a) * 1) + (a * r)) * 255,
            (((1 - a) * 1) + (a * g)) * 255,
            (((1 - a) * 1) + (a * b)) * 255
        ];
    }
    
    // Converts #hexcolors into [r, g, b] arrays
    function hex2rgb(hex) {
        var validHEXInput = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        if (!validHEXInput) {
            return false;
        }
        return [
            parseInt(validHEXInput[1], 16),
            parseInt(validHEXInput[2], 16),
            parseInt(validHEXInput[3], 16)
        ];
    }
    // Converts #hexcolors into [r, g, b, a] arrays
    function hex2rgba(hex) {
        var validHEXInput = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        if (!validHEXInput) {
            return false;
        }
        return [
            parseInt(validHEXInput[1], 16),
            parseInt(validHEXInput[2], 16),
            parseInt(validHEXInput[3], 16),
            parseInt(validHEXInput[4], 16)
        ];
    }
    // Computes contrast between two [r, g, b] arrays
    function contrast(rgb1, rgb2) {
        var lum1 = luminance(rgb1[0], rgb1[1], rgb1[2]);
        var lum2 = luminance(rgb2[0], rgb2[1], rgb2[2]);
        var brightest = Math.max(lum1, lum2);
        var darkest = Math.min(lum1, lum2);
        return (brightest + 0.05)
            / (darkest + 0.05);
    }
    // Computes the luminance of a [r, g, b] color
    function luminance(r, g, b) {
        var a = [r, g, b].map(function (v) {
            v /= 255;
            return v <= 0.03928
                ? v / 12.92
                : Math.pow( (v + 0.055) / 1.055, 2.4 );
        });
        return a[0] * 0.2126 + a[1] * 0.7152 + a[2] * 0.0722;
    }
  </script>

</head>
<body class="sky">
	<div class="cloud x1"></div>
	<div class="cloud x2"></div>
	<div class="cloud x3"></div>
	<div class="cloud x4"></div>
	<div class="cloud x5"></div>
	<div class="cloud x6"></div>
	<div class="cloud x7"></div>
	<div class="cloud x11"></div>
	<div class="cloud x12"></div>
	<div class="cloud x13"></div>
	<div class="cloud x14"></div>
	<div class="cloud x15"></div>
	<div class="cloud x16"></div>
	<div class="cloud x17"></div>

<div id="container">
    
    <div class="center">
        <img src="logos/logo-zanzocam.png" alt="Logo ZANZOCAM" width="150px">
        <div  style="margin-bottom: 2rem;"><small>v0.10.0</small></div>
        <h1>Impostazioni</h1>        
    </div>
    
    <div id="loading" class="center">
        <hr />
        <h2>Caricamento...</h2>
        <hr />
    </div>
    
    <div id="loading-local" class="sheet" style="display: none;">
        <h3>Scegli il file di configurazione da modificare:</h3>
        <input type="file" id="configFile">
    </div>
    
    <div id="main-form" style="display:none;">
    
        <form id="config">
            <div class="sheet">
                <div class="row">
                    <h3>Server:</h3>
                    <label class="toggle">
                        <input type="radio" value="HTTP" name="server__protocol" onclick="javascript:toggle_server_protocol('HTTP')">
                        <span class="label">HTTP</span>
                    </label><br>
                    <label class="toggle">
                        <input type="radio" value="FTP" name="server__protocol" checked onclick="javascript:toggle_server_protocol('FTP')">
                        <span class="label">FTP</span>
                    </label><br>
                </div> 

                <div id="server_protocol_HTTP-vars" class="row">
                    <div class="column">
                        <label for="server__url">URL del server:</label>
                        <input type="text" placeholder="https://example.com/foto" id="server-url" name="server__url">
                    </div>
                </div>
                
                <div id="server_protocol_FTP-vars" style="display: none; flex-direction:column!important;">
                    <div class="row">
                        <div class="column">
                            <label>Hostname:</label>
                            <input type="text" placeholder="example.com" id="server-hostname" name="server__hostname">
                        </div>
                    </div>
                    <div class="row">
                        <div class="column">
                            <label class="label-inline">Sottocartella (se necessaria):</label>
                            <input type="text" name="server__subfolder">
                        </div>
                        <div class="column">
                            <label class="label-inline">Avanzate:</label>
                            <div style="padding: 10px;">
                                <input type="checkbox" name="server__tls" checked>
                                <label class="label-inline" >Usa TLS</label>
                            </div>
                        </div>
                    </div>
                </div>

                <label for="server__username">Username (se necessario):</label>
                <input type="text" name="server__username">
                
                <label for="server__password">Password (se necessaria):</label>
                <div class="row">
                    <input type="password" name="server__password">
                    <button onclick="toggle_password(this);" type="button">Mostra</button> 
                </div> 
            </div>
            
            <div class="sheet">
                <h3>Orario:</h3>

                <div class="row">
                    <div class="column">
                        <label class="label-inline">Inizia a scattare alle:</label>
                        <input type="text" placeholder="00:01" name="time__start_activity">
                    </div>
                    <div class="column">
                        <label class="label-inline">Smetti di scattare alle:</label>
                        <input type="text" placeholder="23:59" name="time__stop_activity">
                    </div>
                    <div class="column">
                        <label class="label-inline">Frequenza scatti:</label>
                        <select name="time__frequency">
                          <option value=0 >Manuale</option>
                          <option value=5 >Ogni 5 minuti</option>
                          <option value=10 >Ogni 10 minuti</option>
                          <option value=15 >Ogni 15 minuti</option>
                          <option value=20 >Ogni 20 minuti</option>
                          <option value=30 >Ogni 30 minuti</option>
                          <option value=60 selected="selected">Ogni ora</option>
                          <option value=120 >Ogni 2 ore</option>
                          <option value=240 >Ogni 4 ore</option>
                          <option value=480 >Ogni 8 ore</option>
                        </select>
                    </div>
                </div>

                <p><b>Configurazione manuale</b>
                <br>
                <b>NOTA BENE:</b> Questi campi vengono usati solo se selezioni
                "Manuale" come frequenza di scatto. Gli orari di inizio e fine,
                inoltre, vengono utilizzati anche se il crontab dovesse specificare
                diversamente.
                </p>
                <div class="row">
                    <div class="column">
                        <label class="label-inline">Minuti:</label>
                        <input type="text" placeholder="*"  name="time__minute">
                    </div>
                    <div class="column">
                        <label class="label-inline">Ora:</label>
                        <input type="text" placeholder="*" name="time__hour">
                    </div>
                    <div class="column">
                        <label class="label-inline">Giorno:</label>
                        <input type="text" placeholder="*" name="time__day">
                    </div>
                    <div class="column">
                        <label class="label-inline">Mese:</label>
                        <input type="text" placeholder="*" name="time__month">
                    </div>
                    <div class="column">
                        <label class="label-inline">G. settimana:</label>
                        <input type="text" placeholder="*" name="time__weekday">
                    </div>
                </div>
            </div>
            
     <!-------------------------------------------------------------------------->
        
            <div class="sheet">
                <h3>Foto:</h3>

                <!-- Note that this fields actually write to the server block! -->
                <label for="server__max_photos">Numero di foto da tenere:</label>
                <div class="row">
                    <div class="column">
                        <div class="row" style="margin-bottom:15px;">
                            <label class="toggle">
                                <input type="radio" value="1" name="server__max_photos"  checked onclick="javascript:document.getElementById('max_photos_block').style.display = 'none';">
                                <span class="label">Solo una</span>
                            </label><br>
                            <label class="toggle">
                                <input type="radio" id="max_photos_value" name="server__max_photos" value="" onclick="javascript:document.getElementById('max_photos_block').style.display = 'block';">
                                <span class="label">Multiple</span>
                            </label><br>
                            <label class="toggle">
                                <input type="radio" name="server__max_photos" value="0" onclick="javascript:document.getElementById('max_photos_block').style.display = 'none';">
                                <span class="label">Tutte</span>
                            </label><br>
                        </div>
                    </div>
                    <div class="column" id="max_photos_block" style="display:none;">
                        <div class="row">
                            <label style="margin:7px;">Quante:</label>
                            <input id="max_photos_input" type="text" style="max-width:100px;" oninput="javascript:document.getElementById('max_photos_value').value=this.value;">
                        </div> 
                    </div> 
                </div>
                
                <div class="row">
                    <div class="column column-75">
                        <label for="image__name">Nome:</label>
                        <input type="text" placeholder="no-name"  name="image__name">
                    </div>
                    <div class="column">
                        <label for="image__extension">Estensione:</label>
                        <select name="image__extension">
                          <option value="jpg" selected="selected">JPG</option>
                          <option value="png">PNG</option>
                          <option value="gif">GIF</option>
                        </select>
                    </div>
                </div>

                <p>NOTA: non utilizzare un doppio underscore ( __ ) nel nome della foto.</p>
                
                <div class="row">
                    <div class="column">
                        <label class="label-inline">Risoluzione:</label>
                        <select id="resolution_selector">
                          <option data-width=4056 data-height=3040 value=3040> 12 Megapixel, 4:3 (4056x3040) - solo per chip da 12MP</option>
                          <option data-width=4056 data-height=2281 value=2281> 10 Megapixel, 16:9 (4056x2281) - solo per chip da 12MP</option>
                          <option data-width=3790 data-height=2132 value=2132> 8 Megapixel (4K), 16:9 (3790x2132) - solo per chip da 12MP</option>
                          <option data-width=3280 data-height=2464 value=2464> 8 Megapixel (4K), 4:3 (3280x2464)</option>
                          <option data-width=3280 data-height=1845 value=1845> 6 Megapixel, 16:9 (3280x1845)</option>
                          <option data-width=2310 data-height=1732 value=1732> 4 Megapixel (2K), 4:3 (2310x1732)</option>
                          <option data-width=2666 data-height=1520 value=1520 selected="selected"> 4 Megapixel (2K), 16:9 (2666x1500)</option>
                          <option data-width=1920 data-height=1080 value=1080> 2 Megapixel (FHP), 16:9 (1920x1080)</option>
                          <option data-width=1280 data-height=720 value=720> 1 Megapixel (HD), 16:9 (1280x720)</option>
                          <option data-width=640 data-height=480 value=480> 0.3 Megapixel (VGA), 4:3 (640x480)</option>
                        </select>
                        <div style="display:none;">
                            <input type="text" id="image__width" name="image__width">
                            <input type="text" id="image__height" name="image__height">
                        </div>
                    </div>
                    <div class="column">
                        <div class="row" style="padding: 20px 0 0 20px;">
                            <input type="checkbox"  name="image__hor_flip">
                            <label class="label-inline" for="image__hor_flip">Speccha in orizzontale</label>
                        </div>
                        <div class="row" style="padding: 0 0 20px 20px;">
                            <input type="checkbox"  name="image__ver_flip">
                            <label class="label-inline" for="image__ver_flip">Specchia in verticale</label>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="column">
                        <label>Qualita' (JPEG):</label>
                        <input type="text" name="image__jpeg_quality">
                    </div>
                    <div class="column">
                        <label>Rotazione:</label>
                        <select name="image__rotation">
                            <option value="0" selected="selected">0</option>
                            <option value="90">90</option>
                            <option value="180">180</option>
                            <option value="270">270</option>
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="column">
                        <label>Bilanciamento Bianco (AWB):</label>
                        <select name="image__awb_mode">
                            <option value="auto" selected="selected">Automatico (opzione consigliata)</option>
                            <option value="cloudy">Nuvoloso</option>
                            <option value="sunlight">Luce diurna</option>
                            <option value="shade">Ombreggiato</option>
                            <option value="horizon">Orizzonte</option>
                            <option value="flash">Flash</option>
                            <option value="fluorescent">Lampade fluorescenti</option>
                            <option value="tungsten">Lampade al tungsteno</option>
                            <option value="incandescent">Lampade a incandescenza</option>
                            <option value="off">Off (Non bilanciare il bianco)</option>
                        </select>
                    </div>
                    <div class="column color-selector">
                        <label>Colore Sfondo (RGBA):</label>
                        <select id="image__background_color" onchange="setColorField(this.nextElementSibling, this.value);">
                            <option value=""></option>
                            <option value="#FFFFFF">bianco</option>
                            <option value="#CCCCCC">grigio chiaro</option>
                            <option value="#999999">grigio</option>
                            <option value="#333333">grigio scuro</option>
                            <option value="#000000">nero</option>
                            <option value="#FF0000">rosso</option>
                            <option value="#FFFF00">giallo</option>
                            <option value="#008000">verde</option>
                            <option value="#0000FF">blu</option>
                            <option value="#00000088">nero semitrasparente</option>
                            <option value="#FFFFFF88">bianco semitrasparente</option>
                        </select>
                        <input value="" name="image__background_color" oninput="setColorField(this, this.value, 'image__background_color');"/>
                    </div>
                </div>

                <div class="row">
                    <div class="column">
                        <label>Formato Data:</label>
                        <input type="text" placeholder="%d %B %Y"  name="image__date_format">
                    </div>
                    <div class="column">
                        <label>Formato Ora:</label>
                        <input type="text" placeholder="%H:%M"  name="image__time_format">
                    </div>
                </div>
                <div class="row">
                    <div class="column">
                        <details style="padding-bottom:1rem;">
                            <summary>Come aggiungo ora e data alla foto?</summary>
                            <p>
                                <br>
                                Per aggiungere data e ora nella foto, seleziona "Testo" nella posizione desiderata e 
                                usa <b>%%TIME</b> per indicare l'ora, <b>%%DATE</b> per indicare la data.<br>
                                Per esempio, se nel testo scrivi "Data di oggi: %%DATE", sull'immagine vedrai 
                                qualcosa di simile a "Data di oggi: 01 gennaio 2021".<br>
                                Qua sotto c'e' la lista dei simboli che possono essere utilizzati per formattare data e ora.
                                Qualunque altro simbolo (due punti, trattini, virgole ecc) verra' copiato nella data.<br>
                                Per esempio, il formato "%d --> %B --> %Y" diventera' qualcosa di simile a "01 --> gennaio --> 2021".
                            </p>

                            <table>
                                <thead>
                                    <tr>
                                        <th>Simbolo</th>
                                        <th>Significato</th>
                                        <th>Esempio</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>%H</td>
                                        <td>Ora (24 ore), sempre con due cifre.</td>
                                        <td>00, 01, ..., 23</td>
                                    </tr>
                                    <tr>
                                        <td>%I</td>
                                        <td>Ora (12 ore), sempre con due cifre</td>
                                        <td>01, 02, ..., 12</td>
                                    </tr>
                                    <tr>
                                        <td>%p</td>
                                        <td>AM o PM (per distinguere le ore tra mattina e pomeriggio).</td>
                                        <td>am, pm</td>
                                    <tr>
                                        <td>%M</td>
                                        <td>Minuti nell'ora corrente, sempre con due cifre</td>
                                        <td>00, 01, ..., 59</td>
                                    </tr>
                                    <tr>
                                        <td>%S</td>
                                        <td>Secondi nel minuto corrente, sempre con due cifre.</td>
                                        <td>00, 01, ..., 59</td>
                                    </tr>
                                    <tr>
                                        <td>%a</td>
                                        <td>Nome del giorno della settimana, abbreviato</td>
                                        <td>Lun, Mar, ..., Dom</td>
                                    </tr>
                                    <tr>
                                        <td>%A</td>
                                        <td>Nome del giorno della settimana, completo</td>
                                        <td>Lunedi', Martedi', ..., Domenica</td>
                                    </tr>
                                    <tr>
                                        <td>%u</td>
                                        <td>Giorno della settimana come numero, dove 1 e' lunedi' e 7 e' domenica</td>
                                        <td>1, 2, ..., 7</td>                                        
                                    </tr>
                                    <tr>
                                        <td>%d</td>
                                        <td>Giorno del mese, sempre con due cifre</td>
                                        <td>01, 02, ..., 31</td>
                                    </tr>
                                    <tr>
                                        <td>%b</td>
                                        <td>Nome del mese, abbreviato</td>
                                        <td>Gen, Feb, ..., Dic</td>
                                    </tr>
                                    <tr>
                                        <td>%B</td>
                                        <td>Nome del mese, completo</td>
                                        <td>Gennaio, Febbraio, ..., Dicembre</td>
                                    </tr>
                                    <tr>
                                        <td>%m</td>
                                        <td>Numero del mese, sempre con due cifre</td>
                                        <td>01, 02, ..., 12</td>
                                    </tr>
                                    <tr>
                                        <td>%y</td>
                                        <td>Anno, senza secolo, sempre con due cifre</td>
                                        <td>00, 01, ..., 99</td>
                                    </tr>
                                    <tr>
                                        <td>%Y</td>
                                        <td>Anno completo, sempre con quattro cifre</td>
                                        <td>0001, 0002, ..., 2010, 2011, ...</td>
                                    </tr>
                                    <tr>
                                        <td>%j</td>
                                        <td>Giorno dell'anno, sempre con tre cifre</td>
                                        <td>001, 002, ..., 366</td>
                                    </tr>
                                    <tr>
                                        <td>%W</td>
                                        <td>Settimana dell'anno (iniziando da lunedi'), sempre con due cifre</td>
                                        <td>00, 01, ..., 53</td>
                                    </tr>
                                    <tr>
                                        <td>%V</td>
                                        <td>Settimana dell'anno iniziando da lunedi', dove la prima settimana dell'anno e' la numero 1 e non la numero 0.</td>
                                        <td>01, 02, ..., 53</td>
                                    </tr>
                                </tbody>
                            </table>

                            <p>Per altre opzioni, vai a 
                                <a href="https://docs.python.org/3/library/datetime.html#strftime-and-strptime-format-codes" target="_blank" rel="noopener noreferrer">questo link</a>.
                            </p>
                        </details>
                    </div>
                </div>

            </div>

            <div class="sheet">
                <h3>Testo e Immagini:</h3>

 <!-------------------------------------------------------------------------->
                <div class="sheet-inner">
                    <div class="row">
                        <h4>In alto a destra</h4>
                        <label class="toggle">
                            <input type="radio" value="" name="overlays__top_right__type" checked onclick="javascript:toggle_type_of_overlay('top_right', 'neither')">
                            <span class="label">Niente</span>
                        </label><br>
                        <label class="toggle">
                            <input type="radio" value="text" name="overlays__top_right__type" onclick="javascript:toggle_type_of_overlay('top_right', 'text')">
                            <span class="label">Testo</span>
                        </label><br>
                        <label class="toggle">
                            <input type="radio" value="image" name="overlays__top_right__type" onclick="javascript:toggle_type_of_overlay('top_right', 'image')">
                            <span class="label">Immagine</span>
                        </label><br>
                    </div> 
                    
                    <div id="top_right_text-vars"  class="overlay-fields" style="display: none;">
                        <label for="overlays__top_right__text">Testo</label>
                        <textarea placeholder="... testo ..." name="overlays__top_right__text"></textarea>
                        
                        <div class="row">
                            <div class="column">
                                <label>Dimensione del font:</label>
                                <input type="text" placeholder="30"  name="overlays__top_right__font_size">
                            </div>
                            <div class="column" style="padding:40px 0 0 10px;">
                                <input type="checkbox"  name="overlays__top_right__over_the_picture">
                                <label class="label-inline" for="overlays__top_right__over_the_picture">Dentro il perimetro della foto</label>
                            </div>
                        </div>

                        <div class="row">
                            <div class="column color-selector">
                                <label for="overlays__top_right__font_color">Colore Testo (RGBA):</label>
                                    <select id="overlays__top_right__font_color" onchange="setColorField(this.nextElementSibling, this.value);">
                                        <option value=""></option>
                                        <option value="#FFFFFF">bianco</option>
                                        <option value="#CCCCCC">grigio chiaro</option>
                                        <option value="#999999">grigio</option>
                                        <option value="#333333">grigio scuro</option>
                                        <option value="#000000" selected="selected">nero (default)</option>
                                        <option value="#FF0000">rosso</option>
                                        <option value="#FFFF00">giallo</option>
                                        <option value="#008000">verde</option>
                                        <option value="#0000FF">blu</option>
                                        <option value="#00000088">nero semitrasparente</option>
                                        <option value="#FFFFFF88">bianco semitrasparente</option>
                                    </select>
                                    <input value="" name="overlays__top_right__font_color" oninput="setColorField(this, this.value, 'overlays__top_right__font_color');"/>
                            </div>
                            <div class="column color-selector">
                                <label for="overlays__top_right__background_color">Colore Sfondo (RGBA):</label>
                                    <select id="overlays__top_right__background_color" onchange="setColorField(this.nextElementSibling, this.value);">
                                        <option value=""></option>
					<option value="#FFFFFF" selected="selected">bianco (default)</option>
                                        <option value="#CCCCCC">grigio chiaro</option>
                                        <option value="#999999">grigio</option>
                                        <option value="#333333">grigio scuro</option>
                                        <option value="#000000">nero</option>
                                        <option value="#FF0000">rosso</option>
                                        <option value="#FFFF00">giallo</option>
                                        <option value="#008000">verde</option>
                                        <option value="#0000FF">blu</option>
                                        <option value="#00000088">nero semitrasparente</option>
                                        <option value="#FFFFFF88">bianco semitrasparente</option>
                                    </select>
                                    <input value="" name="overlays__top_right__background_color" oninput="setColorField(this, this.value, 'overlays__top_right__background_color');"/>
                            </div>
                        </div>
                        
                    </div>
                    
                    <div id="top_right_image-vars" class="overlay-fields" style="display: none;">

                        <div class="row">
                            <div class="column" style="padding-bottom: 20px;">
                                <label>Immagine Attuale: <b><span id="overlays__top_right__path_current"></span></b></label>
                                <img id="overlays__top_right__preview" alt="Preview non disponibile" height="150"></img>
                            </div> 
                        </div> 
                        <div class="row">
                            <div class="column">
                                <label>Scegli Nuovo File</label>
                                <input type="file" class="image-picker" name="overlays__top_right__file" id="overlays__top_right" onchange="javascript:document.getElementById('overlays__top_right__path').value = this.files[0].name;">
                            </div>
                            <div class="column">
                                <label>Inserisci Nome:</label>
                                <div class="row">
                                    <input type="text" id="overlays__top_right__path" name="overlays__top_right__path" oninput="javascript:document.getElementById('overlays__top_right__path_current').innerHTML=this.value;document.getElementById('overlays__top_right__preview').src='../configuration/overlays/'+this.value;">
                                </div>
                            </div>
                        </div>
                        <label class="logos-title">Loghi gia' online:</label>
                        <div class="row">
                            <div class="row logos-list" data-position="top_right"></div>
                        </div>

                        <div class="row">
                            <div class="column">
                                <label>Larghezza:</label>
                                <input type="text" name="overlays__top_right__width">
                            </div>
                            <div class="column">
                                <label>Altezza:</label>
                                <input type="text" name="overlays__top_right__height">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Margine (% dim. immagine):</label>
                                <input type="text" placeholder="0.2"  name="overlays__top_right__padding_ratio">
                            </div>
                            <div class="column" style="padding:40px 0 0 10px;">
                                <input type="checkbox"  name="overlays__top_right__over_the_picture">
                                <label class="label-inline" for="overlays__top_right__over_the_picture">Dentro il perimetro della foto</label>                  
                            </div>
                        </div>
                    </div>
                    
                </div>
                
     <!-------------------------------------------------------------------------->
                
               <div class="sheet-inner">
  
                   <div class="row">
                        <h4>In alto al centro</h4>
                        <label class="toggle">
                            <input type="radio" value="" name="overlays__top_center__type" checked onclick="javascript:toggle_type_of_overlay('top_center', 'neither')">
                            <span class="label">Niente</span>
                        </label><br>
                        <label class="toggle">
                            <input type="radio" value="text" name="overlays__top_center__type" onclick="javascript:toggle_type_of_overlay('top_center', 'text')">
                            <span class="label">Testo</span>
                        </label><br>
                        <label class="toggle">
                            <input type="radio" value="image" name="overlays__top_center__type" onclick="javascript:toggle_type_of_overlay('top_center', 'image')">
                            <span class="label">Immagine</span>
                        </label><br>
                    </div> 
                    
                    <div id="top_center_text-vars"  class="overlay-fields" style="display: none;">
                        <label for="top_center_text-content">Testo</label>
                        <textarea placeholder="... testo ..." name="overlays__top_center__text"></textarea>
                        
                        <div class="row">
                            <div class="column">
                                <label>Dimensione del font:</label>
                                <input type="text" placeholder="30"  name="overlays__top_center__font_size">
                            </div>
                            <div class="column" style="padding:40px 0 0 10px;">
                                <input type="checkbox"  name="overlays__top_center__over_the_picture">
                                <label class="label-inline" for="overlays__top_center__over_the_picture">Dentro il perimetro della foto</label>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column color-selector">
                                <label for="overlays__top_center__font_color">Colore Testo (RGBA):</label>
                                <span>
                                    <select id="overlays__top_center__font_color" onchange="setColorField(this.nextElementSibling, this.value);">
                                        <option value=""></option>
                                        <option value="#FFFFFF">bianco</option>
                                        <option value="#CCCCCC">grigio chiaro</option>
                                        <option value="#999999">grigio</option>
                                        <option value="#333333">grigio scuro</option>
                                        <option value="#000000" selected="selected">nero (default)</option>
                                        <option value="#FF0000">rosso</option>
                                        <option value="#FFFF00">giallo</option>
                                        <option value="#008000">verde</option>
                                        <option value="#0000FF">blu</option>
                                        <option value="#00000088">nero semitrasparente</option>
                                        <option value="#FFFFFF88">bianco semitrasparente</option>
                                    </select>
                                    <input value="" name="overlays__top_center__font_color" oninput="setColorField(this, this.value, 'overlays__top_center__font_color');"/>
                                </span>
                            </div>
                            <div class="column color-selector">
                                <label for="overlays__top_center__background_color">Colore Sfondo (RGBA):</label>
                                <span>
                                    <select id="overlays__top_center__background_color" onchange="setColorField(this.nextElementSibling, this.value);">
                                        <option value=""></option>
                                        <option value="#FFFFFF" selected="selected">bianco (default)</option>
                                        <option value="#CCCCCC">grigio chiaro</option>
                                        <option value="#999999">grigio</option>
                                        <option value="#333333">grigio scuro</option>
                                        <option value="#000000">nero</option>
                                        <option value="#FF0000">rosso</option>
                                        <option value="#FFFF00">giallo</option>
                                        <option value="#008000">verde</option>
                                        <option value="#0000FF">blu</option>
                                        <option value="#00000088">nero semitrasparente</option>
                                        <option value="#FFFFFF88">bianco semitrasparente</option>
                                    </select>
                                    <input value="" name="overlays__top_center__background_color" oninput="setColorField(this, this.value, 'overlays__top_center__background_color');"/>
                                </span>
                            </div>
                        </div>
                    </div>                
         
                    <div id="top_center_image-vars"  class="overlay-fields" style="display: none;">
                        
                        <div class="row">
                            <div class="column" style="padding-bottom: 20px;">
                                <label>Immagine Attuale: <b><span id="overlays__top_center__path_current"></span></b></label>
                                <img id="overlays__top_center__preview" alt="Preview non disponibile" height="150"></img>
                            </div> 
                        </div> 
                        <div class="row">
                            <div class="column">
                                <label>Scegli Nuovo File</label>
                                <input type="file" class="image-picker" name="overlays__top_center__file" id="overlays__top_center" onchange="javascript:document.getElementById('overlays__top_center__path').value = this.files[0].name;">
                            </div>
                            <div class="column">
                                <label>Inserisci Nome:</label>
                                <div class="row">
                                    <input type="text" id="overlays__top_center__path" name="overlays__top_center__path" oninput="javascript:document.getElementById('overlays__top_center__path_current').innerHTML=this.value;document.getElementById('overlays__top_center__preview').src='../configuration/overlays/'+this.value;">
                                </div>
                            </div>
                        </div>
                        <label class="logos-title">Loghi gia' online:</label>
                        <div class="row">
                            <div class="row logos-list" data-position="top_center"></div>
                        </div>
                            
                        <div class="row">
                            <div class="column">
                                <label>Larghezza:</label>
                                <input type="text" name="overlays__top_center__width">
                            </div>
                            <div class="column">
                                <label>Altezza:</label>
                                <input type="text" name="overlays__top_center__height">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Margine (% dim. immagine):</label>
                                <input type="text" placeholder="0.2"  name="overlays__top_center__padding_ratio">
                            </div>
                            <div class="column" style="padding:40px 0 0 10px;">
                                <input type="checkbox"  name="overlays__top_center__over_the_picture">
                                <label class="label-inline" for="overlays__top_center__over_the_picture">Dentro il perimetro della foto</label>               
                            </div>
                        </div>
                    </div>
                </div>

     <!-------------------------------------------------------------------------->
                
               <div class="sheet-inner">
 
                   <div class="row">
                        <h4>In alto a sinistra</h4>
                        <label class="toggle">
                            <input type="radio" value="" name="overlays__top_left__type" checked onclick="javascript:toggle_type_of_overlay('top_left', 'neither')">
                            <span class="label">Niente</span>
                        </label><br>
                        <label class="toggle">
                            <input type="radio" value="text" name="overlays__top_left__type" onclick="javascript:toggle_type_of_overlay('top_left', 'text')">
                            <span class="label">Testo</span>
                        </label><br>
                        <label class="toggle">
                            <input type="radio" value="image" name="overlays__top_left__type" onclick="javascript:toggle_type_of_overlay('top_left', 'image')">
                            <span class="label">Immagine</span>
                        </label><br>
                    </div> 

                    <div id="top_left_text-vars"  class="overlay-fields" style="display: none;">
                        <label for="top_left_text-content">Testo</label>
                        <textarea placeholder="... testo ..." name="overlays__top_left__text"></textarea>
                        
                        <div class="row">
                            <div class="column">
                                <label>Dimensione del font:</label>
                                <input type="text" placeholder="30"  name="overlays__top_left__font_size">
                            </div>
                            <div class="column" style="padding:40px 0 0 10px;">
                                <input type="checkbox"  name="overlays__top_left__over_the_picture">
                                <label class="label-inline" for="overlays__top_left__over_the_picture">Dentro il perimetro della foto</label>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column color-selector">
                                <label for="overlays__top_left__font_color">Colore Testo (RGBA):</label>
                                <span>
                                    <select id="overlays__top_left__font_color" onchange="setColorField(this.nextElementSibling, this.value);">
                                        <option value=""></option>
                                        <option value="#FFFFFF">bianco</option>
                                        <option value="#CCCCCC">grigio chiaro</option>
                                        <option value="#999999">grigio</option>
                                        <option value="#333333">grigio scuro</option>
                                        <option value="#000000" selected="selected">nero (default)</option>
                                        <option value="#FF0000">rosso</option>
                                        <option value="#FFFF00">giallo</option>
                                        <option value="#008000">verde</option>
                                        <option value="#0000FF">blu</option>
                                        <option value="#00000088">nero semitrasparente</option>
                                        <option value="#FFFFFF88">bianco semitrasparente</option>
                                    </select>
                                    <input value="" name="overlays__top_left__font_color" oninput="setColorField(this, this.value, 'overlays__top_left__font_color');"/>
                                </span>
                            </div>
                            <div class="column color-selector">
                                <label for="overlays__top_left__background_color">Colore Sfondo (RGBA):</label>
                                <span>
                                    <select id="overlays__top_left__background_color" onchange="setColorField(this.nextElementSibling, this.value);">
                                        <option value=""></option>
                                        <option value="#FFFFFF" selected="selected">bianco (default)</option>
                                        <option value="#CCCCCC">grigio chiaro</option>
                                        <option value="#999999">grigio</option>
                                        <option value="#333333">grigio scuro</option>
                                        <option value="#000000">nero</option>
                                        <option value="#FF0000">rosso</option>
                                        <option value="#FFFF00">giallo</option>
                                        <option value="#008000">verde</option>
                                        <option value="#0000FF">blu</option>
                                        <option value="#00000088">nero semitrasparente</option>
                                        <option value="#FFFFFF88">bianco semitrasparente</option>
                                    </select>
                                    <input value="" name="overlays__top_left__background_color" oninput="setColorField(this, this.value, 'overlays__top_left__background_color');"/>
                                </span>
                            </div>
                        </div>
                    </div>                
         
                    <div id="top_left_image-vars"  class="overlay-fields" style="display: none;">
                        
                        <div class="row">
                            <div class="column" style="padding-bottom: 20px;">
                                <label>Immagine Attuale: <b><span id="overlays__top_left__path_current"></span></b></label>
                                <img id="overlays__top_left__preview" alt="Preview non disponibile" height="150"></img>
                            </div> 
                        </div>              
                        <div class="row">
                            <div class="column">
                                <label>Scegli Nuovo File</label>
                                <input type="file" class="image-picker" name="overlays__top_left__file" id="overlays__top_left" onchange="javascript:document.getElementById('overlays__top_left__path').value = this.files[0].name;">
                            </div>
                            <div class="column">
                                <label>Inserisci Nome:</label>
                                <div class="row">
                                    <input type="text" id="overlays__top_left__path" name="overlays__top_left__path" oninput="javascript:document.getElementById('overlays__top_left__path_current').innerHTML=this.value;document.getElementById('overlays__top_left__preview').src='../configuration/overlays/'+this.value;">
                                </div>
                            </div>
                        </div>
                        <label class="logos-title">Loghi gia' online:</label>
                        <div class="row">
                            <div class="row logos-list" data-position="top_left"></div>
                        </div>
                            
                        <div class="row">
                            <div class="column">
                                <label>Larghezza:</label>
                                <input type="text" name="overlays__top_left__width">
                            </div>
                            <div class="column">
                                <label>Altezza:</label>
                                <input type="text" name="overlays__top_left__height">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Margine (% dim. immagine):</label>
                                <input type="text" placeholder="0.2"  name="overlays__top_left__padding_ratio">
                            </div>
                            <div class="column" style="padding:40px 0 0 10px;">
                                <input type="checkbox"  name="overlays__top_left__over_the_picture">
                                <label class="label-inline" for="overlays__top_left__over_the_picture">Dentro il perimetro della foto</label>                  
                            </div>
                        </div>
                    </div>
                </div>

     <!-------------------------------------------------------------------------->
                
                <div class="sheet-inner">
                    <div class="row">
                        <h4>In basso a destra</h4>
                        <label class="toggle">
                            <input type="radio" value="" name="overlays__bottom_right__type" checked onclick="javascript:toggle_type_of_overlay('bottom_right', 'neither')">
                            <span class="label">Niente</span>
                        </label><br>
                        <label class="toggle">
                            <input type="radio" value="text" name="overlays__bottom_right__type" onclick="javascript:toggle_type_of_overlay('bottom_right', 'text')">
                            <span class="label">Testo</span>
                        </label><br>
                        <label class="toggle">
                            <input type="radio" value="image" name="overlays__bottom_right__type" onclick="javascript:toggle_type_of_overlay('bottom_right', 'image')">
                            <span class="label">Immagine</span>
                        </label><br>
                    </div>

                    <div id="bottom_right_text-vars"  class="overlay-fields" style="display: none;">
                        <label for="bottom_right_text-content">Testo</label>
                        <textarea placeholder=".. testo ..." name="overlays__bottom_right__text"></textarea>
                        
                        <div class="row">
                            <div class="column">
                                <label>Dimensione del font:</label>
                                <input type="text" placeholder="30"  name="overlays__bottom_right__font_size">
                            </div>
                            <div class="column" style="padding:40px 0 0 10px;">
                                <input type="checkbox"  name="overlays__bottom_right__over_the_picture">
                                <label class="label-inline" for="overlays__bottom_right__over_the_picture">Dentro il perimetro della foto</label>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column color-selector">
                                <label for="overlays__bottom_right__font_color">Colore Testo (RGBA):</label>
                                <span>
                                    <select id="overlays__bottom_right__font_color" onchange="setColorField(this.nextElementSibling, this.value);">
                                        <option value=""></option>
                                        <option value="#FFFFFF">bianco</option>
                                        <option value="#CCCCCC">grigio chiaro</option>
                                        <option value="#999999">grigio</option>
                                        <option value="#333333">grigio scuro</option>
                                        <option value="#000000" selected="selected">nero (default)</option>
                                        <option value="#FF0000">rosso</option>
                                        <option value="#FFFF00">giallo</option>
                                        <option value="#008000">verde</option>
                                        <option value="#0000FF">blu</option>
                                        <option value="#00000088">nero semitrasparente</option>
                                        <option value="#FFFFFF88">bianco semitrasparente</option>
                                    </select>
                                    <input value="" name="overlays__bottom_right__font_color" oninput="setColorField(this, this.value, 'overlays__bottom_right__font_color');"/>
                                </span>
                            </div>
                            <div class="column color-selector">
                                <label for="overlays__bottom_right__background_color">Colore Sfondo (RGBA):</label>
                                <span>
                                    <select id="overlays__bottom_right__background_color" onchange="setColorField(this.nextElementSibling, this.value);">
                                        <option value=""></option>
                                        <option value="#FFFFFF" selected="selected">bianco (default)</option>
                                        <option value="#CCCCCC">grigio chiaro</option>
                                        <option value="#999999">grigio</option>
                                        <option value="#333333">grigio scuro</option>
                                        <option value="#000000">nero</option>
                                        <option value="#FF0000">rosso</option>
                                        <option value="#FFFF00">giallo</option>
                                        <option value="#008000">verde</option>
                                        <option value="#0000FF">blu</option>
                                        <option value="#00000088">nero semitrasparente</option>
                                        <option value="#FFFFFF88">bianco semitrasparente</option>
                                    </select>
                                    <input value="" name="overlays__bottom_right__background_color" oninput="setColorField(this, this.value, 'overlays__bottom_right__background_color');"/>
                                </span>
                            </div>
                        </div>
                    </div>                
         
                    <div id="bottom_right_image-vars"  class="overlay-fields" style="display: none;">
                        
                        <div class="row">
                            <div class="column" style="padding-bottom: 20px;">
                                <label>Immagine Attuale: <b><span id="overlays__bottom_right__path_current"></span></b></label>
                                <img id="overlays__bottom_right__preview" alt="Preview non disponibile" height="150"></img>
                            </div> 
                        </div> 
                        <div class="row">
                            <div class="column">
                                <label>Scegli Nuovo File</label>
                                <input type="file" class="image-picker" name="overlays__bottom_right__file" id="overlays__bottom_right" onchange="javascript:document.getElementById('overlays__bottom_right__path').value = this.files[0].name;">
                            </div>
                            <div class="column">
                                <label>Inserisci Nome:</label>
                                <div class="row">
                                    <input type="text" id="overlays__bottom_right__path" name="overlays__bottom_right__path" oninput="javascript:document.getElementById('overlays__bottom_right__path_current').innerHTML=this.value;document.getElementById('overlays__bottom_right__preview').src='../configuration/overlays/'+this.value;">
                                </div>
                            </div>
                        </div>
                        <label class="logos-title">Loghi gia' online:</label>
                        <div class="row">
                            <div class="row logos-list" data-position="bottom_right"></div>
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Larghezza:</label>
                                <input type="text" name="overlays__bottom_right__width">
                            </div>
                            <div class="column">
                                <label>Altezza:</label>
                                <input type="text" name="overlays__bottom_right__height">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Margine (% dim. immagine):</label>
                                <input type="text" placeholder="0.2"  name="overlays__bottom_right__padding_ratio">
                            </div>
                            <div class="column" style="padding:40px 0 0 10px;">
                                <input type="checkbox"  name="overlays__bottom_right__over_the_picture">
                                <label class="label-inline" for="overlays__bottom_right__over_the_picture">Dentro il perimetro della foto</label>                
                            </div>
                        </div>
                    </div>  
                </div>

     <!-------------------------------------------------------------------------->
                
                <div class="sheet-inner">
                    <div class="row">
                        <h4>In basso al centro</h4>
                        <label class="toggle">
                            <input type="radio" value="" name="overlays__bottom_center__type" checked onclick="javascript:toggle_type_of_overlay('bottom_center', 'neither')">
                            <span class="label">Niente</span>
                        </label><br>
                        <label class="toggle">
                            <input type="radio" value="text" name="overlays__bottom_center__type" onclick="javascript:toggle_type_of_overlay('bottom_center', 'text')">
                            <span class="label">Testo</span>
                        </label><br>
                        <label class="toggle">
                            <input type="radio" value="image" name="overlays__bottom_center__type" onclick="javascript:toggle_type_of_overlay('bottom_center', 'image')">
                            <span class="label">Immagine</span>
                        </label><br>
                    </div>
                    
                    <div id="bottom_center_text-vars"  class="overlay-fields" style="display: none;">
                        <label for="bottom_center_text-content">Testo</label>
                        <textarea placeholder=".. testo ..." name="overlays__bottom_center__text"></textarea>
                        
                        <div class="row">
                            <div class="column">
                                <label>Dimensione del font:</label>
                                <input type="text" placeholder="30"  name="overlays__bottom_center__font_size">
                            </div>
                            <div class="column" style="padding:40px 0 0 10px;">
                                <input type="checkbox"  name="overlays__bottom_center__over_the_picture">
                                <label class="label-inline" for="overlays__bottom_center__over_the_picture">Dentro il perimetro della foto</label>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column color-selector">
                                <label for="overlays__bottom_center__font_color">Colore Testo (RGBA):</label>
                                <span>
                                    <select id="overlays__bottom_center__font_color" onchange="setColorField(this.nextElementSibling, this.value);">
                                        <option value=""></option>
                                        <option value="#FFFFFF">bianco</option>
                                        <option value="#CCCCCC">grigio chiaro</option>
                                        <option value="#999999">grigio</option>
                                        <option value="#333333">grigio scuro</option>
                                        <option value="#000000" selected="selected">nero (default)</option>
                                        <option value="#FF0000">rosso</option>
                                        <option value="#FFFF00">giallo</option>
                                        <option value="#008000">verde</option>
                                        <option value="#0000FF">blu</option>
                                        <option value="#00000088">nero semitrasparente</option>
                                        <option value="#FFFFFF88">bianco semitrasparente</option>
                                    </select>
                                    <input value="" name="overlays__bottom_center__font_color" oninput="setColorField(this, this.value, 'overlays__bottom_center__font_color');"/>
                                </span>
                            </div>
                            <div class="column color-selector">
                                <label for="overlays__bottom_center__background_color">Colore Sfondo (RGBA):</label>
                                <span>
                                    <select id="overlays__bottom_center__background_color" onchange="setColorField(this.nextElementSibling, this.value);">
                                        <option value=""></option>
                                        <option value="#FFFFFF" selected="selected">bianco (default)</option>
                                        <option value="#CCCCCC">grigio chiaro</option>
                                        <option value="#999999">grigio</option>
                                        <option value="#333333">grigio scuro</option>
                                        <option value="#000000">nero</option>
                                        <option value="#FF0000">rosso</option>
                                        <option value="#FFFF00">giallo</option>
                                        <option value="#008000">verde</option>
                                        <option value="#0000FF">blu</option>
                                        <option value="#00000088">nero semitrasparente</option>
                                        <option value="#FFFFFF88">bianco semitrasparente</option>
                                    </select>
                                    <input value="" name="overlays__bottom_center__background_color" oninput="setColorField(this, this.value, 'overlays__bottom_center__background_color');"/>
                                </span>
                            </div>
                        </div>
                    </div>                
         
                    <div id="bottom_center_image-vars"  class="overlay-fields" style="display: none;">
                        
                        <div class="row">
                            <div class="column" style="padding-bottom: 20px;">
                                <label>Immagine Attuale: <b><span id="overlays__bottom_center__path_current"></span></b></label>
                                <img id="overlays__bottom_center__preview" alt="Preview non disponibile" height="150"></img>
                            </div> 
                        </div> 
                        <div class="row">
                            <div class="column">
                                <label>Scegli Nuovo File</label>
                                <input type="file" class="image-picker" name="overlays__bottom_center__file" id="overlays__bottom_center" onchange="javascript:document.getElementById('overlays__bottom_center__path').value = this.files[0].name;">
                            </div>
                            <div class="column">
                                <label>Inserisci Nome:</label>
                                <div class="row">
                                    <input type="text" id="overlays__bottom_center__path" name="overlays__bottom_center__path" oninput="javascript:document.getElementById('overlays__bottom_center__path_current').innerHTML=this.value;document.getElementById('overlays__bottom_center__preview').src='../configuration/overlays/'+this.value;">
                                </div>
                            </div>
                        </div>
                        <label class="logos-title">Loghi gia' online:</label>
                        <div class="row">
                            <div class="row logos-list" data-position="bottom_center"></div>
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Larghezza:</label>
                                <input type="text" name="overlays__bottom_center__width">
                            </div>
                            <div class="column">
                                <label>Altezza:</label>
                                <input type="text" name="overlays__bottom_center__height">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Margine (% dim. immagine):</label>
                                <input type="text" placeholder="0.2"  name="overlays__bottom_center__padding_ratio">
                            </div>
                            <div class="column" style="padding:40px 0 0 10px;">
                                <input type="checkbox"  name="overlays__bottom_center__over_the_picture">
                                <label class="label-inline" for="overlays__bottom_center__over_the_picture">Dentro il perimetro della foto</label>         
                            </div>
                        </div>
                    </div> 
                </div> 

     <!-------------------------------------------------------------------------->
                
                <div class="sheet-inner">
                    <div class="row">
                        <h4>In basso a sinistra</h4>
                        <label class="toggle">
                            <input type="radio" value="" name="overlays__bottom_left__type" checked onclick="javascript:toggle_type_of_overlay('bottom_left', 'neither')">
                            <span class="label">Niente</span>
                        </label><br>
                        <label class="toggle">
                            <input type="radio" value="text" name="overlays__bottom_left__type" onclick="javascript:toggle_type_of_overlay('bottom_left', 'text')">
                            <span class="label">Testo</span>
                        </label><br>
                        <label class="toggle">
                            <input type="radio" value="image" name="overlays__bottom_left__type" onclick="javascript:toggle_type_of_overlay('bottom_left', 'image')">
                            <span class="label">Immagine</span>
                        </label><br>
                    </div>
                    
                    <div id="bottom_left_text-vars"  class="overlay-fields" style="display: none;">
                        <label for="bottom_left_text-content">Testo</label>
                        <textarea placeholder="... testo ..." name="overlays__bottom_left__text"></textarea>
                        
                        <div class="row">
                            <div class="column">
                                <label>Dimensione del font:</label>
                                <input type="text" placeholder="30"  name="overlays__bottom_left__font_size">
                            </div>
                            <div class="column" style="padding:40px 0 0 10px;">
                                <input type="checkbox"  name="overlays__bottom_left__over_the_picture">
                                <label class="label-inline" for="overlays__bottom_left__over_the_picture">Dentro il perimetro della foto</label>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column color-selector">
                                <label for="overlays__bottom_left__font_color">Colore Testo (RGBA):</label>
                                <span>
                                    <select id="overlays__bottom_left__font_color" onchange="setColorField(this.nextElementSibling, this.value);">
                                        <option value=""></option>
                                        <option value="#FFFFFF">bianco</option>
                                        <option value="#CCCCCC">grigio chiaro</option>
                                        <option value="#999999">grigio</option>
                                        <option value="#333333">grigio scuro</option>
                                        <option value="#000000" selected="selected">nero (default)</option>
                                        <option value="#FF0000">rosso</option>
                                        <option value="#FFFF00">giallo</option>
                                        <option value="#008000">verde</option>
                                        <option value="#0000FF">blu</option>
                                        <option value="#00000088">nero semitrasparente</option>
                                        <option value="#FFFFFF88">bianco semitrasparente</option>
                                    </select>
                                    <input value="" name="overlays__bottom_left__font_color" oninput="setColorField(this, this.value, 'overlays__bottom_left__font_color');"/>
                                </span>
                            </div>
                            <div class="column color-selector">
                                <label for="overlays__bottom_left__background_color">Colore Sfondo (RGBA):</label>
                                <span>
                                    <select id="overlays__bottom_left__background_color" onchange="setColorField(this.nextElementSibling, this.value);">
                                        <option value=""></option>
                                        <option value="#FFFFFF" selected="selected">bianco (default)</option>
                                        <option value="#CCCCCC">grigio chiaro</option>
                                        <option value="#999999">grigio</option>
                                        <option value="#333333">grigio scuro</option>
                                        <option value="#000000">nero</option>
                                        <option value="#FF0000">rosso</option>
                                        <option value="#FFFF00">giallo</option>
                                        <option value="#008000">verde</option>
                                        <option value="#0000FF">blu</option>
                                        <option value="#00000088">nero semitrasparente</option>
                                        <option value="#FFFFFF88">bianco semitrasparente</option>
                                    </select>
                                    <input value="" name="overlays__bottom_left__background_color" oninput="setColorField(this, this.value, 'overlays__bottom_left__background_color');"/>
                                </span>
                            </div>
                        </div>
                    </div>                
         
                    <div id="bottom_left_image-vars"  class="overlay-fields" style="display: none;">
                        
                        <div class="row">
                            <div class="column" style="padding-bottom: 20px;">
                                <label>Immagine Attuale: <b><span id="overlays__bottom_left__path_current"></span></b></label>
                                <img id="overlays__bottom_left__preview" alt="Preview non disponibile" height="150"></img>
                            </div> 
                        </div> 
                        <div class="row">
                            <div class="column">
                                <label>Scegli Nuovo File</label>
                                <input type="file" class="image-picker" name="overlays__bottom_left__file" id="overlays__bottom_left" onchange="javascript:document.getElementById('overlays__bottom_left__path').value = this.files[0].name;">
                            </div>
                            <div class="column">
                                <label>Inserisci Nome:</label>
                                <div class="row">
                                    <input type="text" id="overlays__bottom_left__path" name="overlays__bottom_left__path" oninput="javascript:document.getElementById('overlays__bottom_left__path_current').innerHTML=this.value;document.getElementById('overlays__bottom_left__preview').src='../configuration/overlays/'+this.value;">
                                </div>
                            </div>
                        </div>
                        <label class="logos-title">Loghi gia' online:</label>
                        <div class="row">
                            <div class="row logos-list" data-position="bottom_left"></div>
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Larghezza:</label>
                                <input type="text" name="overlays__bottom_left__width">
                            </div>
                            <div class="column">
                                <label>Altezza:</label>
                                <input type="text" name="overlays__bottom_left__height">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Margine (% dim. immagine):</label>
                                <input type="text" placeholder="0.2"  name="overlays__bottom_left__padding_ratio">
                            </div>
                            <div class="column" style="padding:40px 0 0 10px;">
                                <input type="checkbox"  name="overlays__bottom_left__over_the_picture">
                                <label class="label-inline" for="overlays__bottom_left__over_the_picture">Dentro il perimetro della foto</label>           
                            </div>
                        </div>
                    </div>
                </div>
            </div>

     <!-------------------------------------------------------------------------->
            
            <div class="center">
                <input id="save" class="button-primary" type="submit" value="Salva">
            </div>     
        </form>
       
    </div>
</div>

<script>
    // Figures out the endpoint URL and mode of operation (local/remote)
    const baseUrl = window.location.href.substring(0, window.location.href.lastIndexOf("/"));
    const url = baseUrl.substring(0, baseUrl.lastIndexOf("/")+1); 
    const localMode = url.startsWith("file://");
    const form = document.getElementById('config');
    form.reset();
    
    // Hooks on the configFile filepicker to load the configuration file if in local mode
    document.getElementById('configFile').addEventListener('change', function selectedFileChanged() {
        form.reset();
        loadDataFromFile(this);
    });
    
    // Hooks on the image filepickers to load the image preview if in local mode
    document.querySelectorAll('.image-picker').forEach((item) => {
        item.addEventListener('change', function selectedFileChanged() {
            loadLocalImage(this);
        });
    })
    
    // Checkboxes with the same name should always have the same value.
    document.querySelectorAll('input[type="checkbox"]').forEach((item) => {
        item.addEventListener('change', function selectedFileChanged() {
            document.querySelectorAll('input[name="'+item.name+'"]').forEach((sameItem) => {
                sameItem.checked = item.checked;
            });
        });
    })

    // Resolution selector listener
    document.getElementById("resolution_selector").onchange = function(event){
        var width = event.target.options[event.target.selectedIndex].dataset.width;
        var height = event.target.options[event.target.selectedIndex].dataset.height;
        document.getElementById('image__width').value = width;
        document.getElementById('image__height').value = height;
    };

    // Create the logos list by querying the server if possible
    if(!localMode){
        populateLogosLists();
    } else {
        document.querySelectorAll('.logos-title').forEach((title) => {
            title.style.display = "none";
        });
    }
    
    // Hooks on the Save button click event to trigger the save operation
    form.onsubmit = async (e) => {
        e.preventDefault();
        var button = document.getElementById("save");
        button.disabled = true;
        button.value = "Sto salvando...";
        saveConfiguration(url);
        button.disabled = false;
        button.value = "Salva";
    }
    
    // Loads the data at the start
    var last_loaded_data = null;
    if (localMode){
        document.getElementsByClassName("sky")[0].classList.add("dark-sky");
        document.getElementById('loading').style.display = "none";
        document.getElementById('loading-local').style.display = "block";
    } else {
        document.getElementsByClassName("sky")[0].classList.add("light-sky");
        loadDataFromServer(url);
    }
</script>

</body>
</html>
